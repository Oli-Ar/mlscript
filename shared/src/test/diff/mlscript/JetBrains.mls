
class Expr
class Lit: Expr & { val: int }
class Add: Expr & { lhs: Expr; rhs: Expr }
//│ Defined class Expr
//│ Defined class Lit
//│ Defined class Add

rec def eval x = case x of {
  Lit -> x.val
  | Add -> eval x.lhs + eval x.rhs
  }
//│ eval: 'a -> int
//│   where
//│     'a <: (Add with {lhs: 'a, rhs: 'a}) | Lit
//│     = [Function: eval]

def eval eval x = case x of {
  Lit -> x.val
  | Add -> eval eval x.lhs + eval eval x.rhs
  }
//│ eval: ('a -> 'rhs -> int & 'a -> 'lhs -> int & 'a) -> ((Add with {lhs: 'lhs, rhs: 'rhs}) | (Lit with {val: 'val})) -> (int | 'val)
//│     = [Function: eval1]

:e
eval eval
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?val, ?lhs, ?rhs, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h, ?i. ?a -> ?f -> (?val | ?i) <: (forall ?val, ?lhs, ?rhs, ?j, ?k, ?l, ?m, ?n, ?o, ?p, ?q, ?r. ?j -> ?o -> (?val | ?r)) -> ?s` exceeded recursion depth limit (400)
//│ ║  l.26: 	eval eval
//│ ║        	^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α226
//│ ╟── while constraining:  α214  <!<  α226
//│ ╟── while constraining:  (α214,)  <!<  (α226,)
//│ ╟── while constraining:  (α226 -> (α233 -> (val235 | α237)))  <!<  ((α214,) -> α215)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α214,) -> α215)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α214
//│ ╟── while constraining:  α202  <!<  α214
//│ ╟── while constraining:  (α202,)  <!<  (α214,)
//│ ╟── while constraining:  (α214 -> (α221 -> (val223 | α225)))  <!<  ((α202,) -> α203)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α202,) -> α203)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α202
//│ ╟── while constraining:  α190  <!<  α202
//│ ╟── while constraining:  (α190,)  <!<  (α202,)
//│ ╟── while constraining:  (α202 -> (α209 -> (val211 | α213)))  <!<  ((α190,) -> α191)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α190,) -> α191)
//│ ╟── ......
//│ ╟── ......
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α106,) -> α107)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α106
//│ ╟── while constraining:  α94  <!<  α106
//│ ╟── while constraining:  (α94,)  <!<  (α106,)
//│ ╟── while constraining:  (α106 -> (α113 -> (val115 | α117)))  <!<  ((α94,) -> α95)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α94,) -> α95)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α94
//│ ╟── while constraining:  α82  <!<  α94
//│ ╟── while constraining:  (α82,)  <!<  (α94,)
//│ ╟── while constraining:  (α94 -> (α101 -> (val103 | α105)))  <!<  ((α82,) -> α83)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α82,) -> α83)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α82
//│ ╟── while constraining:  (‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›,)  <!<  (α82,)
//│ ╟── while constraining:  (α82 -> (α89 -> (val91 | α93)))  <!<  ((‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›,) -> α81)
//│ ╙── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›,) -> α81)
//│ res: error
//│    = [Function (anonymous)]

class Neg: Expr & { underlying: Expr }
//│ Defined class Neg

def evalN evalN x = case x of {
  Neg -> 0 - (evalN evalN x.underlying)
  | _ -> eval evalN x
  }
//│ evalN: ('a -> 'underlying -> int & 'a -> 'rhs -> int & 'a -> 'lhs -> int & 'a) -> ((Add with {lhs: 'lhs, rhs: 'rhs}) | (Lit with {val: 'val}) | (Neg with {underlying: 'underlying})) -> (int | 'val)
//│      = [Function: evalN]

:e
evalN evalN
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?underlying, ?rhs, ?lhs, ?val, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h, ?i, ?j, ?k, ?l, ?m, ?n, ?o, ?p, ?q. ?a -> ?i -> (?o | ?p) <: (forall ?underlying, ?rhs, ?lhs, ?val, ?r, ?s, ?t, ?u, ?v, ?w, ?x, ?y, ?z, ?a1, ?b1, ?c1, ?d1, ?e1, ?f1, ?g1, ?h1. ?r -> ?z -> (?f1 | ?g1)) -> ?i1` exceeded recursion depth limit (400)
//│ ║  l.76: 	evalN evalN
//│ ║        	^^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α482
//│ ╟── while constraining:  α462  <!<  α482
//│ ╟── while constraining:  (α462,)  <!<  (α482,)
//│ ╟── while constraining:  (α482 -> (α493 -> (α500 | α501)))  <!<  ((α462,) -> α463)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α462,) -> α463)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α462
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α461
//│ ╟── while constraining:  α441  <!<  α461
//│ ╟── while constraining:  (α441,)  <!<  (α461,)
//│ ╟── while constraining:  (α461 -> (α472 -> (α479 | α480)))  <!<  ((α441,) -> α442)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α441,) -> α442)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α441
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α440
//│ ╟── while constraining:  α420  <!<  α440
//│ ╟── while constraining:  (α420,)  <!<  (α440,)
//│ ╟── ......
//│ ╟── ......
//│ ╟── while constraining:  α336  <!<  α356
//│ ╟── while constraining:  (α336,)  <!<  (α356,)
//│ ╟── while constraining:  (α356 -> (α367 -> (α374 | α375)))  <!<  ((α336,) -> α337)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α336,) -> α337)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α336
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α335
//│ ╟── while constraining:  α315  <!<  α335
//│ ╟── while constraining:  (α315,)  <!<  (α335,)
//│ ╟── while constraining:  (α335 -> (α346 -> (α353 | α354)))  <!<  ((α315,) -> α316)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α315,) -> α316)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α315
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α314
//│ ╟── while constraining:  (‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›,)  <!<  (α314,)
//│ ╟── while constraining:  (α314 -> (α325 -> (α332 | α333)))  <!<  ((‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›,) -> α313)
//│ ╙── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›,) -> α313)
//│ res: error
//│    = [Function (anonymous)]

e = Add{lhs = Lit{val = 1}; rhs = Neg{underlying = Lit{val = 2}}}
//│ e: Add with {lhs: Lit & {val: 1}, rhs: Neg with {underlying: Lit & {val: 2}}}
//│  = Add { lhs: Lit { val: 1 }, rhs: Neg { underlying: Lit { val: 2 } } }

:e
evalN evalN e
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?underlying, ?rhs, ?lhs, ?val, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h, ?i, ?j, ?k, ?l, ?m, ?n, ?o, ?p, ?q. ?a -> ?i -> (?o | ?p) <: (forall ?underlying, ?rhs, ?lhs, ?val, ?r, ?s, ?t, ?u, ?v, ?w, ?x, ?y, ?z, ?a1, ?b1, ?c1, ?d1, ?e1, ?f1, ?g1, ?h1. ?r -> ?z -> (?f1 | ?g1)) -> ?i1` exceeded recursion depth limit (400)
//│ ║  l.120: 	evalN evalN e
//│ ║         	^^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α722
//│ ╟── while constraining:  α702  <!<  α722
//│ ╟── while constraining:  (α702,)  <!<  (α722,)
//│ ╟── while constraining:  (α722 -> (α733 -> (α740 | α741)))  <!<  ((α702,) -> α703)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α702,) -> α703)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α702
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α701
//│ ╟── while constraining:  α681  <!<  α701
//│ ╟── while constraining:  (α681,)  <!<  (α701,)
//│ ╟── while constraining:  (α701 -> (α712 -> (α719 | α720)))  <!<  ((α681,) -> α682)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α681,) -> α682)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α681
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α680
//│ ╟── while constraining:  α660  <!<  α680
//│ ╟── while constraining:  (α660,)  <!<  (α680,)
//│ ╟── ......
//│ ╟── ......
//│ ╟── while constraining:  α576  <!<  α596
//│ ╟── while constraining:  (α576,)  <!<  (α596,)
//│ ╟── while constraining:  (α596 -> (α607 -> (α614 | α615)))  <!<  ((α576,) -> α577)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α576,) -> α577)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α576
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α575
//│ ╟── while constraining:  α555  <!<  α575
//│ ╟── while constraining:  (α555,)  <!<  (α575,)
//│ ╟── while constraining:  (α575 -> (α586 -> (α593 | α594)))  <!<  ((α555,) -> α556)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α555,) -> α556)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α555
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α554
//│ ╟── while constraining:  (‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›,)  <!<  (α554,)
//│ ╟── while constraining:  (α554 -> (α565 -> (α572 | α573)))  <!<  ((‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›,) -> α553)
//│ ╙── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›,) -> α553)
//│ res: error
//│    = -1




// === === === ERROR CASES === === === //



:ShowRelativeLineNums
:AllowTypeErrors



:e
def evalN2 evalN2 x = case x of {
  Neg -> 0 - (evalN2 evalN2 x.underlying)
  | _ -> eval eval x
  }
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?val, ?lhs, ?rhs, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h, ?i. ?a -> ?f -> (?val | ?i) <: (forall ?val, ?lhs, ?rhs, ?j, ?k, ?l, ?m, ?n, ?o, ?p, ?q, ?r. ?j -> ?o -> (?val | ?r)) -> ?s` exceeded recursion depth limit (400)
//│ ║  l.+3: 	  | _ -> eval eval x
//│ ║        	         ^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α933'
//│ ╟── while constraining:  α921'  <!<  α933'
//│ ╟── while constraining:  (α921',)  <!<  (α933',)
//│ ╟── while constraining:  (α933' -> (α940' -> (val942' | α944')))  <!<  ((α921',) -> α922')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α921',) -> α922')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α921'
//│ ╟── while constraining:  α909'  <!<  α921'
//│ ╟── while constraining:  (α909',)  <!<  (α921',)
//│ ╟── while constraining:  (α921' -> (α928' -> (val930' | α932')))  <!<  ((α909',) -> α910')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α909',) -> α910')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α909'
//│ ╟── while constraining:  α897'  <!<  α909'
//│ ╟── while constraining:  (α897',)  <!<  (α909',)
//│ ╟── while constraining:  (α909' -> (α916' -> (val918' | α920')))  <!<  ((α897',) -> α898')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α897',) -> α898')
//│ ╟── ......
//│ ╟── ......
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α813',) -> α814')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α813'
//│ ╟── while constraining:  α801'  <!<  α813'
//│ ╟── while constraining:  (α801',)  <!<  (α813',)
//│ ╟── while constraining:  (α813' -> (α820' -> (val822' | α824')))  <!<  ((α801',) -> α802')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α801',) -> α802')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α801'
//│ ╟── while constraining:  α789'  <!<  α801'
//│ ╟── while constraining:  (α789',)  <!<  (α801',)
//│ ╟── while constraining:  (α801' -> (α808' -> (val810' | α812')))  <!<  ((α789',) -> α790')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α789',) -> α790')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α789'
//│ ╟── while constraining:  (‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›,)  <!<  (α789',)
//│ ╟── while constraining:  (α789' -> (α796' -> (val798' | α800')))  <!<  ((‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›,) -> α788')
//│ ╙── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›,) -> α788')
//│ evalN2: ('a -> 'underlying -> int & 'a) -> ((Neg with {underlying: 'underlying}) | ~Neg) -> (error | int)

:e
evalN2 evalN2 e
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?underlying, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h. ?b -> ?e -> (?g | ?h) <: (forall ?underlying, ?a, ?i, ?j, ?k, ?l, ?m, ?n, ?o. ?i -> ?l -> (?n | ?o)) -> ?p` exceeded recursion depth limit (400)
//│ ║  l.+1: 	evalN2 evalN2 e
//│ ║        	^^^^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1086
//│ ╟── while constraining:  α1077  <!<  α1086
//│ ╟── while constraining:  (α1077,)  <!<  (α1086,)
//│ ╟── while constraining:  (α1086 -> (α1090 -> (α1093 | α1094)))  <!<  ((α1077,) -> α1078)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α1077,) -> α1078)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1077
//│ ╟── while constraining:  α1068  <!<  α1077
//│ ╟── while constraining:  (α1068,)  <!<  (α1077,)
//│ ╟── while constraining:  (α1077 -> (α1081 -> (α1084 | α1085)))  <!<  ((α1068,) -> α1069)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α1068,) -> α1069)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1068
//│ ╟── while constraining:  α1059  <!<  α1068
//│ ╟── while constraining:  (α1059,)  <!<  (α1068,)
//│ ╟── while constraining:  (α1068 -> (α1072 -> (α1075 | α1076)))  <!<  ((α1059,) -> α1060)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α1059,) -> α1060)
//│ ╟── ......
//│ ╟── ......
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α996,) -> α997)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α996
//│ ╟── while constraining:  α987  <!<  α996
//│ ╟── while constraining:  (α987,)  <!<  (α996,)
//│ ╟── while constraining:  (α996 -> (α1000 -> (α1003 | α1004)))  <!<  ((α987,) -> α988)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α987,) -> α988)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α987
//│ ╟── while constraining:  α978  <!<  α987
//│ ╟── while constraining:  (α978,)  <!<  (α987,)
//│ ╟── while constraining:  (α987 -> (α991 -> (α994 | α995)))  <!<  ((α978,) -> α979)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α978,) -> α979)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α978
//│ ╟── while constraining:  (‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›,)  <!<  (α978,)
//│ ╟── while constraining:  (α978 -> (α982 -> (α985 | α986)))  <!<  ((‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›,) -> α977)
//│ ╙── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›,) -> α977)
//│ res: error


def evalN3 evalN3 x = case x of {
  Neg -> 0 - (evalN2 x.underlying)
  | _ -> eval evalN3 x
  }
//│ ╔══[ERROR] Type mismatch in operator application:
//│ ║  l.+2: 	  Neg -> 0 - (evalN2 x.underlying)
//│ ║        	         ^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ╟── function of type `?a -> (?b | ?c)` is not an instance of type `int`
//│ ║  l.172: 	def evalN2 evalN2 x = case x of {
//│ ║         	                  ^^^^^^^^^^^^^^^
//│ ║  l.173: 	  Neg -> 0 - (evalN2 evalN2 x.underlying)
//│ ║         	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ║  l.174: 	  | _ -> eval eval x
//│ ║         	^^^^^^^^^^^^^^^^^^^^
//│ ║  l.175: 	  }
//│ ║         	^^^
//│ ╟── but it flows into application with expected type `int`
//│ ║  l.+2: 	  Neg -> 0 - (evalN2 x.underlying)
//│ ╙──      	              ^^^^^^^^^^^^^^^^^^^
//│ evalN3: ('a -> 'rhs -> int & 'a -> 'lhs -> int & 'a) -> ((Add with {lhs: 'lhs, rhs: 'rhs}) | (Lit with {val: 'val}) | (Neg with {underlying: 'b -> nothing -> int & 'b})) -> (error | int | 'val)

def evalN3 evalN3 x = case x of {
  Neg -> 0 - (evalN3 x.underlying)
  | _ -> eval evalN3 x
  }
//│ evalN3: ('underlying -> int & 'a -> 'rhs -> int & 'a -> 'lhs -> int & 'a) -> ((Add with {lhs: 'lhs, rhs: 'rhs}) | (Lit with {val: 'val}) | (Neg with {underlying: 'underlying})) -> (int | 'val)

:e
evalN3 evalN3 e
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?underlying, ?rhs, ?lhs, ?val, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h, ?i, ?j, ?k, ?l, ?m, ?n, ?o, ?p. ?a -> ?h -> (?n | ?o) <: (forall ?underlying, ?rhs, ?lhs, ?val, ?q, ?r, ?s, ?t, ?u, ?v, ?w, ?x, ?y, ?z, ?a1, ?b1, ?c1, ?d1, ?e1, ?f1. ?q -> ?x -> (?d1 | ?e1)) -> ?g1` exceeded recursion depth limit (400)
//│ ║  l.+1: 	evalN3 evalN3 e
//│ ║        	^^^^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1392
//│ ╟── while constraining:  α1373  <!<  α1392
//│ ╟── while constraining:  (α1373,)  <!<  (α1392,)
//│ ╟── while constraining:  (α1392 -> (α1402 -> (α1409 | α1410)))  <!<  ((α1373,) -> α1374)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((α1373,) -> α1374)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1373
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1372
//│ ╟── while constraining:  α1353  <!<  α1372
//│ ╟── while constraining:  (α1353,)  <!<  (α1372,)
//│ ╟── while constraining:  (α1372 -> (α1382 -> (α1389 | α1390)))  <!<  ((α1353,) -> α1354)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((α1353,) -> α1354)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1353
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1352
//│ ╟── while constraining:  α1333  <!<  α1352
//│ ╟── while constraining:  (α1333,)  <!<  (α1352,)
//│ ╟── ......
//│ ╟── ......
//│ ╟── while constraining:  α1253  <!<  α1272
//│ ╟── while constraining:  (α1253,)  <!<  (α1272,)
//│ ╟── while constraining:  (α1272 -> (α1282 -> (α1289 | α1290)))  <!<  ((α1253,) -> α1254)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((α1253,) -> α1254)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1253
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1252
//│ ╟── while constraining:  α1233  <!<  α1252
//│ ╟── while constraining:  (α1233,)  <!<  (α1252,)
//│ ╟── while constraining:  (α1252 -> (α1262 -> (α1269 | α1270)))  <!<  ((α1233,) -> α1234)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((α1233,) -> α1234)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1233
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1232
//│ ╟── while constraining:  (‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›,)  <!<  (α1232,)
//│ ╟── while constraining:  (α1232 -> (α1242 -> (α1249 | α1250)))  <!<  ((‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›,) -> α1231)
//│ ╙── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›,) -> α1231)
//│ res: error


